Logic Emulator Documentation

Overview
The Logic Emulator is a software tool for simulating digital logic circuits using netlists. It executes NAND-based netlists to emulate logic gates and circuits, supporting dynamic I/O naming and intermediate file creation. The project uses a Scrum methodology, with the current sprint focused on fixing the XOR test and ensuring robust logging via visual_mem.txt.

Current Status
- XOR Test: Failing at step 1 due to missing intermediate input files (tmp_a_tmp1.<hash>.<subhash>.txt). The first NAND operation (NAND(1,1)=0) works, and visual_mem.txt logs correctly for step 0.
- Full Adder Test: Previously passed but not yet updated for dynamic I/O naming.
- Recursive Netlists: INCLUDE support is planned but deferred until XOR and Full Adder tests are stable.
- Goals:
  - Fix XOR test by ensuring intermediate files are created correctly.
  - Update Full Adder test with dynamic I/O.
  - Reintroduce recursive INCLUDE logic.
- Backlog:
  - 32-bit adder netlist.
  - OR, MUX, ALU netlists.
  - Z80 compatibility.

File Structure
.
├── +x/
│   ├── main.+x        # Compiled emulator executable
│   ├── nand.+x        # NAND gate executable (assumed external)
├── netlist/
│   ├── netlist_xor.txt # XOR netlist
│   ├── netlist_fulladder.txt # Full Adder netlist (not currently used)
├── tmp/
│   ├── input.txt      # Generic input file (e.g., "1\n1\n" for XOR)
│   ├── input.<hash>.txt # Hashed input file
│   ├── tmp1.<hash>.txt # Intermediate file for TMP1
│   ├── tmp2.<hash>.txt # Intermediate file for TMP2
│   ├── tmp3.<hash>.txt # Intermediate file for TMP3
│   ├── tmp_a_tmp1.<hash>.<subhash>.txt # Intermediate file for TMP_A_TMP1
│   ├── tmp_b_tmp1.<hash>.<subhash>.txt # Intermediate file for TMP_B_TMP1
│   ├── tmp2_3.<hash>.<subhash>.txt # Intermediate file for TMP2_3
│   ├── output.<hash>.txt # Output file
│   ├── emulator_xor.log # Debug log for XOR test
├── visual_mem.txt     # Logs NAND outputs and file mappings
├── main.c             # Emulator source code
├── test_xor.sh        # XOR test script
├── test.sh            # Full Adder test script (not currently used)
├── documentation.txt  # This file

Netlist Format
Netlists are text files specifying NAND operations or INCLUDE commands:
- NAND Command: ./+x/nand.+x <input_file> <output_file>
  - <input_file>: INPUT, TMP1, TMP_A_TMP1, etc.
  - <output_file>: TMP1, TMP2, OUTPUT, etc.
- INCLUDE Command: INCLUDE <netlist_file> (not yet implemented).
- XOR Netlist Example (netlist_xor.txt):
  ./+x/nand.+x INPUT TMP1
  ./+x/nand.+x TMP_A_TMP1 TMP2
  ./+x/nand.+x TMP_B_TMP1 TMP3
  ./+x/nand.+x TMP2_3 OUTPUT
  - INPUT: Two-bit input (e.g., 1\n1\n).
  - TMP1: Output of NAND(a,b).
  - TMP_A_TMP1: Combines a (first bit of input) and TMP1.
  - TMP_B_TMP1: Combines b (second bit of input) and TMP1.
  - TMP2_3: Combines TMP2 and TMP3.
  - OUTPUT: Final XOR result.

Usage
1. Compile the Emulator:
   gcc main.c -o +x/main.+x
2. Run the XOR Test:
   sh test_xor.sh
   - Creates tmp/input.txt, netlist/netlist_xor.txt, and runs main.+x.
   - Outputs test result and logs to tmp/emulator_xor.log and visual_mem.txt.
3. Debugging:
   - Check tmp/emulator_xor.log for command execution details.
   - Check visual_mem.txt for NAND outputs and file mappings.
   - Example visual_mem.txt (partial, due to failure):
     Cycle 0 NAND Outputs: 0
     tmp/tmp1.621870.txt:0
     ERROR: Command failed at step 1

Building and Running
- Dependencies: gcc, nand.+x (external NAND gate executable).
- Build:
  gcc main.c -o +x/main.+x
- Run Manually:
  ./+x/main.+x netlist/netlist_xor.txt tmp/output.txt 1
  - <netlist_file>: Path to netlist (e.g., netlist/netlist_xor.txt).
  - <output_file>: Final output file (e.g., tmp/output.txt).
  - <cycles>: Number of cycles (e.g., 1 for single execution).

Debugging
- Logs:
  - tmp/emulator_xor.log: Detailed execution trace, including file creation and command failures.
  - visual_mem.txt: NAND outputs and file mappings per cycle.
- Common Issues:
  - Missing Files: Ensure tmp/ is writable and input.txt exists.
  - Invalid Commands: Check netlist for correct token names (INPUT, TMP1, etc.).
  - Intermediate File Failures: Verify create_intermediate_file triggers correctly.

Current Issues
- XOR Test Failure:
  - Fails at step 1 due to missing tmp/tmp_a_tmp1.<hash>.<subhash>.txt.
  - create_intermediate_file is incorrectly creating the output file (tmp2) instead of the input file.
- Fix in Progress:
  - Updated main.c to correct create_intermediate_file triggers for TMP_A_TMP1 and TMP_B_TMP1.
  - Ensured proper input file selection (first/second line of input.txt).

Future Work
- Short-Term:
  - Fix XOR test by ensuring intermediate files are created.
  - Update Full Adder test with dynamic I/O naming.
  - Reintroduce INCLUDE for recursive netlists.
- Long-Term:
  - Implement 32-bit adder.
  - Support OR, MUX, ALU netlists.
  - Achieve Z80 compatibility.

Testing
- XOR Test:
  sh test_xor.sh
  - Input: 1\n1\n (two bits, both 1).
  - Expected Output: 0 (XOR(1,1)=0).
  - Current Status: Fails at step 1.
- Full Adder Test:
  sh test.sh
  - Not currently used, pending XOR test fix.
